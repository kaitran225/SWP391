<!DOCTYPE html>
<html>
<head>
    <title>Student Dashboard - School Mental Health Support</title>
    <link rel="stylesheet" href="../styles/theme.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container content">
        <h1>Student Mental Health Dashboard</h1>
        
        <div class="dashboard-controls">
            <input 
                type="text" 
                id="studentSearch" 
                placeholder="Search students..." 
                class="search-input"
            >
            <select id="gradeFilter" class="category-filter">
                <option value="all">All Grades</option>
                <option value="9th">9th Grade</option>
                <option value="10th">10th Grade</option>
                <option value="11th">11th Grade</option>
                <option value="12th">12th Grade</option>
            </select>
        </div>

        <div class="dashboard-metrics">
            <div class="metric-card">
                <h3>Class Averages</h3>
                <div id="averageMetrics"></div>
            </div>
        </div>

        <div class="student-list" id="studentList">
            <!-- Student cards will be loaded here -->
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="../scripts/student-dashboard.js"></script>
    <script src="../scripts/displayFunctions.js"></script>
    <script>
        async function displayStudents(students) {
            const studentList = document.getElementById('studentList');
            const averageMetrics = document.getElementById('averageMetrics');
            studentList.innerHTML = '';

            // Display average metrics
            const metrics = StudentDashboard.getAverageMetrics(students);
            if (metrics) {
                averageMetrics.innerHTML = `
                    <p>Anxiety Level: ${metrics.averageAnxiety}/10</p>
                    <p>Stress Level: ${metrics.averageStress}/10</p>
                    <p>Depression Score: ${metrics.averageDepression}/10</p>
                    <p>Sleep Quality: ${metrics.averageSleep}/10</p>
                    <p>Attendance Rate: ${metrics.averageAttendance}%</p>
                `;
            }

            // Display student cards
            students.forEach(student => {
                const card = document.createElement('div');
                card.className = 'student-card';
                card.innerHTML = `
                    <h3>${student.name}</h3>
                    <p>ID: ${student.id} | Grade: ${student.grade}</p>
                    <div class="health-indicators">
                        <span class="health-indicator ${getIndicatorClass(student.mental_health_data.anxiety_level)}">
                            Anxiety: ${student.mental_health_data.anxiety_level}/10
                        </span>
                        <span class="health-indicator ${getIndicatorClass(student.mental_health_data.stress_level)}">
                            Stress: ${student.mental_health_data.stress_level}/10
                        </span>
                    </div>
                    <p>Last Assessment: ${formatDate(student.mental_health_data.last_assessment)}</p>
                `;
                studentList.appendChild(card);
            });
        }

        function getIndicatorClass(value) {
            if (value <= 3) return 'indicator-good';
            if (value <= 6) return 'indicator-warning';
            return 'indicator-danger';
        }

        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString();
        }

        // Initialize page
        async function initializePage() {
            try {
                const students = await StudentDashboard.getStudentData();
                displayStudents(students);

                // Set up event listeners
                document.getElementById('studentSearch')
                    .addEventListener('input', async (e) => {
                        const students = await StudentDashboard.searchStudents(e.target.value);
                        displayStudents(students);
                    });

                document.getElementById('gradeFilter')
                    .addEventListener('change', async (e) => {
                        const students = await StudentDashboard.filterByGrade(e.target.value);
                        displayStudents(students);
                    });
            } catch (error) {
                console.error('Error initializing page:', error);
            }
        }

        // Load data when page loads
        window.addEventListener('load', initializePage);
    </script>
</body>
</html> 